# Podman Compose configuration for Sensey Server with CSV storage
# Compatible with both podman-compose and docker-compose

services:
  sensey-server:
    image: localhost/sensey-server:latest
    container_name: sensey-server-csv

    ports:
      - "5000:5000"

    volumes:
      # Mount configuration (read-only)
      - ./sensey.ini:/app/sensey.ini:ro,Z
      # Mount data directory for CSV storage (read-write)
      - sensey-data:/app/data:Z

    restart: unless-stopped

    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000/health').read()"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

    # Resource limits (optional, adjust as needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 512M

volumes:
  # Named volume for persistent CSV data storage
  sensey-data:
    driver: local
